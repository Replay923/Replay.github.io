<html>
<body>

        <button type="button" onclick="MsPay()">MS Pay</button>

        <script language="javascript" src="https://api.mguwp.net/web/json2.js" ></script>		
        <script language="javascript" src="https://api.mguwp.net/web/h4sdk.js" ></script>

        <script>
                //win10支付开始
            
                function MsPay(){
                    var jsonStorePara=new Object();
                    jsonStorePara.goodsKey="4141A467D31FC5B";
                    jsonStorePara.callback="8af4ef1e-1e24-11e9-a1b4-0017fa000773";
                    jsonStorePara.comment="abcd-efg";
                    jsonStorePara.isOnlyMsPay="1";//是否只使用微软支付。0=否；1=是；2=不使用微软支付            
                    console.log(JSON.stringify(jsonStorePara));
                    openMgStore(JSON.stringify(jsonStorePara));
                };
            
                function MgPaymentResult(result,paymentResult){
                    alert('recharge success_step_1');
                    alert(paymentResult);
                    paymentResult="{\"result\":null,\"comment\":\"abcd-efg\",\"orderKey\":\"bababba\",\"goodsKey\":\"gagagag\",\"price\":\"4.99\"}";
                    var msg="失败";
                    var orderKey="",goodsKey="",goodsTag="",goodsNum="",coinUnit="",price="",customerKey="",comment="";
                    if(result=="success"){
                        alert('recharge success_step_2');
                        msg="成功";
                        var jsonPaymentResult=JSON.parse(paymentResult);
                        orderKey=jsonPaymentResult.orderKey;
                        goodsKey=jsonPaymentResult.goodsKey;
                        goodsTag=jsonPaymentResult.goodsTag;
                        goodsNum=jsonPaymentResult.goodsNum;
                        coinUnit=jsonPaymentResult.coinUnit;
                        price=jsonPaymentResult.price;
                        customerKey=jsonPaymentResult.customerKey;
                        comment=jsonPaymentResult.comment;

                        alert(orderKey +" "+price);
                        var url = '/Win10Game/ajaxback';
                        win10_back_params.order_id = orderKey;
                        win10_back_params.money = price;
                        win10_back_params.total_money = price;
                        win10_back_params.game_id = 312;
                        win10_back_params.server_id = 1448310309;
                        $.ajax({
                            url:url,
                            dataType: 'json',
                            data: win10_back_params,
                            type:'POST',
                            success: function(data){
                                if (data.status==0){
                                    alert('recharge success');
                                }
                            }
                        });
                    }
                }
            </script>
    </body>
</html>